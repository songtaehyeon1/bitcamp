<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.bitcamp.admin.AdminDAOImp">
	<!-- 상품 추가 -->
	<insert id="productWrite" parameterType="kr.co.bitcamp.product.ProductVO" >
		insert into product(c_no,p_no,p_name,price,p_commnet,p_filename1,p_filename2,p_filename3,p_filename4,p_filename5,delivery_fee)
		values(#{c_no},pno_sq.nextval,#{p_name},#{price},#{p_commnet,},#{p_filename1},#{p_filename2},#{p_filename3},#{p_filename4},#{p_filename5},#{delivery_fee})
	</insert>
	<!-- 상품 수정 -->
	<update id="productEdit" parameterType="kr.co.bitcamp.product.ProductVO">
		update product set c_no=#{c_no},p_name=#{p_name},price=${price},p_commnet=#{p_commnet},
		<if test="p_filename1 != null">p_filename1=#{p_filename1},</if>
		<if test="p_filename2 != null">p_filename2=#{p_filename2},</if>
		<if test="p_filename3 != null">p_filename3=#{p_filename3},</if>
		<if test="p_filename4 != null">p_filename4=#{p_filename4},</if>
		<if test="p_filename5 != null">p_filename5=#{p_filename5},</if>
		delivery_fee=${delivery_fee} where p_no = ${p_no}
	</update>
	<!-- 상품 1개선택 -->
	<select id="productSelect" parameterType="kr.co.bitcamp.product.ProductVO" resultType="kr.co.bitcamp.product.ProductVO">
		select p_no,c_no,p_name,price,delivery_fee,p_commnet,p_filename1,p_filename2,p_filename3,p_filename4,p_filename5
		from product where p_no=#{param1}
	</select>
	<update id="delimg">
		update product set ${param2} = null where p_no = ${param1} 
	</update>
	<!-- 관리자 로그인 -->	
	<select id="adminLogin" resultType="kr.co.bitcamp.admin.AdminLoginVO" parameterType="kr.co.bitcamp.admin.AdminLoginVO">
		select * from adminlogin where adminId = #{adminId} and adminpwd = #{adminpwd}
	</select>
	<!-- 모든 카테고리를 반환 -->
	<select id="allCategorySelect"
		resultType="kr.co.bitcamp.category.CategoryVO">
		select c_no,c_name from category order by c_no
	</select>
	<!-- 카테고리안의 상품수를 반환 -->
	<select id="cntCategoryProduct" resultType="int">
		select count(p_no)
		cnt from (select * from product right join category using(c_no)) where
		c_no=#{param1} GROUP by c_no, c_name
	</select>
	<select id="selectCategory"
		resultType="kr.co.bitcamp.category.CategoryVO">
		select c_no,c_name from category where c_no =#{param1}
	</select>
	<update id="updateCategory"
		parameterType="kr.co.bitcamp.category.CategoryVO">
		update category set c_name=#{c_name} where c_no=#{c_no}
	</update>

	<select id="allProductSelect"
		resultType="kr.co.bitcamp.product.ProductVO">
		select
		ROWNUM,p_no,c_no,p_name,price,delivery_fee,p_commnet,p_filename1,p_filename2,p_filename3,p_filename4,p_filename5,p_date,c_name
		from product left join category using(c_no) order by p_no desc
	</select>

	<select id="allList"
		parameterType="kr.co.bitcamp.admin.PagingVO"
		resultType="kr.co.bitcamp.product.ProductVO">
		select * from (
		select * from (
		select rownum,p_no,c_no,p_name,price,delivery_fee,p_commnet,p_filename1,p_filename2,p_filename3,p_filename4,p_filename5,p_date,c_name
		from product left join category using(c_no) 
			<where>
			<if test="searchKey != null and searchWord != null">
				AND ${searchKey} like '%'||#{searchWord}||'%' 
			</if>
			<if test="c_no != 0">
				AND c_no = ${c_no} 
			</if>
			<if test="s_date != null and e_date != null">
				AND to_char(p_date,'YYYY-MM-DD') <![CDATA[>]]>TO_DATE('${s_date}','YYYY-MM-DD') and to_char(p_date,'YYYY-MM-DD') <![CDATA[<=]]> to_date('${e_date}','YYYY-MM-DD') 
			</if>
			</where>
		order by p_no desc)
		where rownum <![CDATA[<=]]>
		#{pageNum} * #{onePageRecord}
		order by p_no asc)
		where rownum <![CDATA[<=]]>
		<if test="pageNum == totalPage">#{lastPageRecord}</if>
		<if test="pageNum != totalPage">#{onePageRecord}</if>
		order by p_no desc
	</select>
	<!-- 전체 페이지 구하기(검색) -->
	<select id="getTotalRecord" parameterType="kr.co.bitcamp.admin.PagingVO" resultType="int">
		select count(p_no) from product left join category using(c_no) 
			<where>
			<if test="searchKey != null and searchWord != null">
				AND ${searchKey} like '%'||#{searchWord}||'%' 
			</if>
			<if test="c_no != 0">
				AND c_no = ${c_no} 
			</if>
			<if test="s_date != null and e_date != null">
				AND to_char(p_date,'YYYY-MM-DD') <![CDATA[>]]>to_date('${s_date}','YYYY-MM-DD') and to_char(p_date,'YYYY-MM-DD') <![CDATA[<=]]> to_date('${e_date}','YYYY-MM-DD') 
			</if>
			</where>


	</select>


</mapper>